<div class="report-form">
  <% if question.present? && question.using_flag && question.check_box.present? %>
    <!-- check_boxが存在し、かつ有効な場合の処理 -->
    <span class="report-item-title mb-2 font-weight-bold"><%= question.check_box.label_name %></span>
    <% if question.required %><span class="pl-2 font-weight-bold text-danger">必須</span><% end %>
    <br>
    <%= f.fields_for :answers, answer do |m| %>
      <% question.check_box.check_box_option_strings.each do |box| %>
        <% boolExists = if answer.array_value.present? 
                          answer.array_value.include? box.option_string
                        else
                          false
                        end
                      %>
        <%= m.check_box :array_value, {multiple: true, include_hidden: false, checked: boolExists, required: question.required}, box[:option_string] %>
        <%= box.option_string %>
      <% end %>
    <% end %>
  <% else %>
     <!-- questionまたはcheck_boxが存在しない場合や無効の場合は表示しない -->
  <% end %>
</div>
